<!-- dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EliteDrive — Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body{background:linear-gradient(180deg,#081718,#041212); color:#e6fff5; min-height:100vh}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); backdrop-filter: blur(6px)}
    .nav{backdrop-filter: blur(4px); background: rgba(2,10,10,0.35)}
    .pill{background:linear-gradient(90deg,#0f9d58,#046f52)}
  </style>
</head>
<body>
  <!-- Top nav -->
  <header class="nav fixed top-0 left-0 right-0 z-40">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="font-bold text-lg">EliteDrive</div>
        <nav class="hidden md:flex gap-4 text-sm">
          <a href="{% url 'courses'%}" class="hover:text-green-300">Courses</a>
          <a href="#enrolled" class="hover:text-green-300">Enrolled</a>
        </nav>
      </div>
      <div class="flex items-center gap-4">
        <a href="{% url 'index'%}" class="text-sm">Home</a>
        <form action="{% url 'account:logout' %}" method = 'post'>
          {% csrf_token %}
          <a href="{% url 'account:logout' %}"><button id="logout" class="text-sm px-3 py-1 border rounded">Sign out</button></a>
        </form>
      </div>
    </div>
  </header>

  <main class="pt-24 max-w-7xl mx-auto px-6 pb-28">
    <section id="hero" class="grid md:grid-cols-3 gap-6">
      <div class="md:col-span-2 card rounded-2xl p-6">
        <h2 class="text-2xl font-bold">Welcome back, <span id="userName">Student</span></h2>
        <p class="mt-2 text-sm text-green-200">Pick a course and book lessons at your convenience.</p>

        <!-- Available courses -->
        <div id="courses" class="mt-6 grid md:grid-cols-2 gap-4"></div>
      </div>

      <aside class="card rounded-2xl p-6">
        <h3 class="font-semibold mb-3">Quick Actions</h3>
        <button id="goAdmin" class="w-full py-2 mb-3 rounded pill">Admin (demo)</button>
        <div class="mt-4">
          <h4 class="font-medium">Enrolled</h4>
          <div id="enrolled" class="mt-3 text-sm text-gray-200">No courses yet.</div>
        </div>
      </aside>
    </section>
  </main>

  <script>
    // mock courses seed if not exist
    const seed = [
      {id:1, title:'Beginner Course', desc:'12 lessons • Manual car', price:120},
      {id:2, title:'Refresher Course', desc:'6 lessons • Flexible', price:80},
      {id:3, title:'Test Preparation', desc:'Mock tests & tips', price:70}
    ];
    if(!localStorage.getItem('ed_courses')) localStorage.setItem('ed_courses', JSON.stringify(seed));

    const current = JSON.parse(localStorage.getItem('ed_current')||'null');
    const users = JSON.parse(localStorage.getItem('ed_users')||'[]');
    if(!current){ /* if not logged in go to login */ /* allow demo landing */}
    document.getElementById('userName').textContent = current?.name || 'Guest';

    function renderCourses(){
      const cs = JSON.parse(localStorage.getItem('ed_courses')||'[]');
      const root = document.getElementById('courses'); root.innerHTML='';
      cs.forEach(c=>{
        const card = document.createElement('div'); card.className='bg-gray-900 p-4 rounded-lg';
        card.innerHTML = `<h4 class="font-semibold text-lg">${c.title}</h4>
                          <p class="text-sm text-green-200 mt-2">${c.desc}</p>
                          <div class="mt-4 flex items-center justify-between">
                            <div class="text-sm text-gray-300">$${c.price}</div>
                            <div class="flex gap-2">
                              <button class="enroll px-3 py-1 rounded bg-green-600 text-sm" data-id="${c.id}">Enroll</button>
                            </div>
                          </div>`;
        root.appendChild(card);
      });
      document.querySelectorAll('.enroll').forEach(b=>{
        b.addEventListener('click', ()=> {
          const id = Number(b.dataset.id);
          const enrolled = JSON.parse(localStorage.getItem('ed_enrolled')||'[]');
          if(!enrolled.find(e=>e.courseId===id)){
            enrolled.push({userId: current?.id || 'guest', courseId:id, date: new Date().toISOString()});
            localStorage.setItem('ed_enrolled', JSON.stringify(enrolled));
            renderEnrolled();
            alert('Enrolled successfully (demo).');
          } else alert('Already enrolled.');
        });
      });
    }

    function renderEnrolled(){
      const enrolled = JSON.parse(localStorage.getItem('ed_enrolled')||'[]');
      const cs = JSON.parse(localStorage.getItem('ed_courses')||'[]');
      const my = enrolled.filter(e => e.userId === (current?.id || 'guest'));
      const node = document.getElementById('enrolled');
      if(!my.length) { node.innerHTML = 'No courses yet.'; return; }
      node.innerHTML = my.map(m => {
        const course = cs.find(c=>c.id===m.courseId);
        return `<div class="py-2 border-b border-gray-800">${course?.title} <div class="text-xs text-gray-400">enrolled ${new Date(m.date).toLocaleDateString()}</div></div>`;
      }).join('');
    }

    document.getElementById('logout').addEventListener('click', ()=>{
      localStorage.removeItem('ed_current'); location.href='index.html';
    });
    document.getElementById('goAdmin').addEventListener('click', ()=> location.href='admin.html');

    renderCourses(); renderEnrolled();
  </script>
</body>
</html>
